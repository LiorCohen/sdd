# Changelog - Version 4.x

All notable changes for major version 4 of the SDD plugin.

---

## [4.9.0] - 2026-01-28

### Fixed

- **External spec handling (Task 7)**: Complete overhaul of how external specs are processed during `sdd-init`
  - External specs are now consumed ONCE during import, then NEVER read again
  - Archived to `specs/external/` for audit purposes only
  - Generated SPEC.md files are completely self-sufficient with embedded `source_content`
  - PLAN.md files are now always created alongside each SPEC.md
  - Epic structure created when 3+ changes are decomposed (with order-preserving prefixes: 01-, 02-, 03-)
  - Added `recommend_epic` flag to spec-decomposition skill
  - Added `source_content` parameter to change-creation skill
  - Added explicit warnings about external spec isolation in sdd-init and sdd-implement-change

### Added

- **External spec workflow test**: New test `sdd-init-external-spec.test.ts` validates:
  - External spec archiving
  - SPEC.md and PLAN.md creation
  - Content embedding
  - External spec isolation

---

## [4.8.0] - 2026-01-28

### Added

- **Component lifecycle npm scripts**: Root package.json now includes component-specific scripts generated dynamically based on project configuration
  - Pattern: `npm run <component-name>:<action>` (e.g., `npm run backend:dev`, `npm run api:generate`)
  - Meta-scripts: `dev`, `build`, `test`, `start`, `generate` orchestrate components with proper dependency ordering
  - Contract types are generated before server/webapp builds

- **Database k8s scripts**: Database component now includes scripts for local Kubernetes deployment
  - `setup` / `teardown`: Deploy/remove PostgreSQL to local k8s via Helm
  - `port-forward`: Forward localhost:5432 to database pod
  - `psql`: Connect to database via psql
  - All existing scripts (`migrate`, `seed`, `reset`) updated with default connection settings

### Changed

- **Root package.json template**: Removed generic `--workspaces --if-present` scripts (didn't respect dependencies)
- **Database package name**: Changed from `{{PROJECT_NAME}}-database` to scoped `@{{PROJECT_NAME}}/database`

### Enhanced

- **scaffolding.ts**: New Step 4 generates component-specific npm scripts after creating template files

---

## [4.7.0] - 2026-01-28

### Added

- **Permission hook for auto-approval**: Plugin now includes a PreToolUse hook that automatically approves writes to safe SDD directories
  - Auto-approves: `specs/`, `components/`, `config/`, `docs/`, `tests/`, `.github/workflows/`
  - Blocks sensitive paths: `.env*`, `secrets/`, `.git/`, `node_modules/`, private keys
  - Hook is auto-registered when plugin is installed (no manual configuration needed)
  - Requires `jq` to be installed

- **Permissions documentation**: New `plugin/docs/permissions.md` with setup guide
  - Explains automatic hook behavior
  - Provides optional static permission patterns for additional coverage
  - Troubleshooting section

- **Recommended permissions config**: New `plugin/config/recommended-permissions.json`
  - Copy-paste JSON for users who want static permission patterns
  - Covers all SDD directories and common operations

### Changed

- **sdd-init command**: Added permission note about ~50+ files created
- **sdd-new-change command**: Added permission note about 2-3 files created
- **README.md**: Added "Reducing Permission Prompts" section with quick setup

---

## [4.6.0] - 2026-01-28

### Added

- **Chunked outline extraction for large specs**: External specs are now processed using a two-phase approach that prevents context overflow
  - Phase 1: Extract headers/outline without LLM (pure regex parsing)
  - Phase 2: Analyze each section individually using the outline's line ranges
  - Works for specs of any size - small specs just have fewer chunks

- **Spec directory support**: `--spec` argument now accepts directories containing multiple markdown files
  - Looks for entry points: `README.md`, `SPEC.md`, `index.md`, `spec.md`
  - Falls back to collecting all `.md` files if no entry point found
  - User can choose boundary level: H1, H2, H3, or file-based

### Changed

- **spec-decomposition skill**: New `mode` parameter (`"outline"` or `"section"`) for chunked processing
  - `outline` mode extracts headers with line ranges (no LLM needed)
  - `section` mode analyzes a single section's content
  - Directory specs include `source_file` field per section

- **external-spec-integration skill**: Outline-first workflow
  - Receives pre-extracted outline from sdd-init Phase 0
  - Presents outline to user for boundary level selection before analysis
  - Reads sections from archived copy (spec copied to project before analysis)

- **product-discovery skill**: Uses outline for intro extraction
  - Reads only the intro section (first ~2000 chars or content before first header)
  - For directories, uses entry point file for discovery

- **sdd-init command**: Extracts outline in Phase 0
  - Outline extracted immediately when spec is loaded
  - Only outline and path stored (never full spec content)
  - Spec copied to project in Phase 7 before decomposition

- **sdd-init command**: Improved phase tracking and completion behavior
  - Added Phase Tracking checklist to ensure all phases complete
  - Explicit instructions to not stop early or ask "should I continue?"
  - External spec completion report now guides to review changes (not install dependencies)
  - Added [R]eview, [L]ist, [I]mplement options for external spec workflows

---

## Infrastructure - 2026-01-28

### Changed

- **Repo structure**: Flatten single-plugin layout
  - `plugins/sdd/` → `plugin/`
  - `tests/sdd/` → `tests/`
  - Updated all path references in configs, tests, docs, and skills

---

## Infrastructure - 2026-01-27

### Fixed

- **Docs**: Synced documentation with v4.4.0 and v4.5.0 plugin changes
  - Added workspace package details and `depends_on` field to `docs/components.md`
  - Added `config/` directory and components doc link to `README.md`
  - Added `SNAPSHOT.md` to `docs/getting-started.md` structure listing
  - Updated `CONTRIBUTING.md` repo structure (added `docs/`, `.claude/agents/`, removed stale `plugins/sdd/README.md` reference)

---

## [4.5.0] - 2026-01-27

### Changed

- **Contract types as workspace packages**: Contract components now publish generated types as npm workspace packages instead of writing directly into sibling directories
  - Contract `package.json` exports `generated/types.ts` via `exports` field
  - Server and webapp templates declare `"workspace:*"` dependency on their contract
  - Template types import from contract package: `import type { components } from '@project/contract'`
  - Removed hardcoded `../server/` and `../webapp/` output paths from contract generate scripts
- **Component `depends_on` field**: Server and webapp components declare which contract(s) they depend on, enabling multi-contract architectures
  - Scaffolding engine resolves `{{CONTRACT_PACKAGE}}` template variable from `depends_on`
  - `substituteVariables` and `copyTemplateFile` now accept component context
- **Updated agents**: api-designer, backend-dev, frontend-dev updated for workspace package import pattern

## [4.4.0] - 2026-01-27

### Changed

- **All component types now multi-instance**: contract, database, helm, testing, cicd join server/webapp with full multi-instance support using unified `[{type, name}]` list format
- **Config moved to project root**: Config is no longer a component type; it always lives at `config/` in the project root
- **Unified component schema**: All components use `{type, name}` objects in `sdd-settings.yaml`, with directory derivation `components/{type}/` (when name = type) or `components/{type}-{name}/` (when they differ)
- **Updated scaffolding engine**: Rewrote `scaffolding.ts` with `ComponentEntry` interface and unified iteration over all component types
- **Updated 25 files**: Skills, agents, commands, templates, docs, and tests updated for new component format

## [4.3.1] - 2026-01-27

### Changed

- **sdd-init**: Initialize git before writing project files (moved from Phase 7 to Phase 5)
  - Git init now runs right after user approval, before any files are created
  - Separate commit phase (Phase 8) stages and commits all created files
  - Added missing `helm` component type to Phase 2 example and Phase 3 summary

## [4.3.0] - 2026-01-27

### Added

- **epic change type**: Add `epic` as a fourth change type alongside feature, bugfix, and refactor
  - Epics group multiple feature-type changes under a single goal
  - Child changes live in a `changes/` subdirectory with their own SPEC.md and PLAN.md
  - Updated skills: spec-writing, planning, epic-planning, change-creation, spec-decomposition
  - Updated agents: spec-writer, planner
  - Updated commands: sdd-new-change, sdd-implement-change, sdd-verify-change
  - Updated docs: README, workflows, commands

---

## Infrastructure - 2026-01-26

### Added

- **docs-writer agent**: New marketplace-level agent at `.claude/agents/docs-writer.md`
  - Writes and maintains user-facing documentation for the SDD plugin
  - Three modes: Audit (detect sync issues), Update (targeted fixes), Rewrite (full refresh)
  - Proactively detects when docs are out of sync with plugin source
  - Includes style guide for pain/outcome messaging and tutorial structure
  - Uses Opus model for quality prose and user empathy

- **docs/ directory**: User-facing documentation at marketplace level
  - `getting-started.md` - First project tutorial
  - `workflows.md` - Feature, bugfix, refactor workflow guides
  - `commands.md` - Command reference
  - `agents.md` - Agent overview for users

### Changed

- **README.md**: Consolidated plugin README into root README
  - Single entry point with hook, value prop, and quick start
  - Links to `docs/` for in-depth tutorials
  - Removed separate plugin-level README

### Removed

- **plugins/sdd/README.md**: Consolidated into root README
- **plugins/sdd/CLAUDE.md**: Developer guidance now only at root level

---

## [4.2.13] - 2026-01-25

### Changed

- **Component format**: Require `name` ALWAYS for all components
  - Both `type` and `name` are now required fields
  - When `name` matches `type`, directory is `components/{type}/`
  - When `name` differs from `type`, directory is `components/{type}-{name}/`
  - Updated: sdd-init, component-recommendation, scaffolding

## [4.2.12] - 2026-01-25

### Added

- **product-discovery skill**: Interactive product discovery with adaptive questioning
  - Extracts problem, users, workflows, entities, integrations, constraints, scope
  - Supports external spec pre-population
- **component-recommendation skill**: Technical component recommendation with dependency validation
  - Maps product requirements to architecture
  - Handles multiple component instances (server:api, webapp:admin)
- **domain-population skill**: Populate domain specs from discovery results
  - TypeScript script for deterministic file creation
  - Creates glossary entries, entity definitions, use-case stubs
- **external-spec-integration skill**: Process external specs into change specifications
  - Orchestrates spec-decomposition and change-creation
  - Handles user adjustment loop (merge/split/rename)

### Changed

- **sdd-init command**: Refactored from 831 to 347 lines (58% reduction)
  - Now an orchestrator that invokes specialized skills
  - Removed inline implementation details
  - Cleaner separation of concerns

## [4.2.11] - 2026-01-24

### Changed

- **CLAUDE.md**: Complete rewrite - focused on guidance for Claude, not implementation details
  - Reduced from ~253 lines to ~50 lines
  - Removed: Architecture details (CMDO, MVVM, telemetry) - belong in agent files
  - Removed: Spec file format, tech stack, development workflow - duplicated README/templates
  - Removed: Version management instructions - belong in commit skill
  - Kept: Commands, agents, key directories, core rules
  - Proper resolution for context window management

---

## Infrastructure - 2026-01-24

### Changed

- **Documentation**: Simplified for single-plugin repository
  - Removed multi-plugin documentation from CONTRIBUTING.md and CLAUDE.md
  - This marketplace contains only the SDD plugin

- **Root README**: Simplified to remove redundancy with plugin README
  - Removed duplicate features, commands, and structure sections
  - Now links to plugin README for full documentation

- **Directory structure**: Moved plugin from `full-stack-spec-driven-dev/` to `plugins/sdd/`
  - Updated all path references in marketplace files, commit skill, and test infrastructure

- **Commit skill**: Moved `scripts/bump-version.sh` to `.claude/skills/commit/`
  - Consolidates version management tooling with commit workflow
  - Updated script paths to use `plugins/sdd/` structure

### Added

- **Plugin testing standards skill**: New marketplace skill at `.claude/skills/plugin-testing-standards/`
  - Documents testing methodology for Claude Code plugins
  - Defines test tiers: unit, workflow, integration
  - Establishes deterministic LLM testing patterns
  - Includes WHY comment requirements and file size guidelines

- **Benchmark module**: New `benchmark.ts` for tracking token usage during tests
  - Per-model usage tracking (Sonnet, Opus, Haiku)
  - JSON report generation in test output directory

### Fixed

- **sdd-new-change workflow test**: Removed incorrect agent detection assertions
  - Command uses `change-creation` skill, not Task tool agents
  - Test now verifies SPEC.md and PLAN.md file creation

- **sdd-init workflow test**: Increased timeout and simplified prompt
  - Timeout increased from 300s to 420s (complex scaffolding operation)
  - Simplified prompt to reduce ambiguity

### Removed

- **Linting-style tests**: Deleted tests that validated format rather than behavior

### Refactored

- **Test infrastructure**: Reorganized `tests/sdd/src/` with lib/tests separation
  - Migrated from Python/pytest to TypeScript/Vitest
  - `src/lib/` - All helper modules (paths, fs, process, project, claude, http)
  - `src/tests/unit/` - Unit tests (no LLM required)
  - `src/tests/workflows/` - Workflow tests (LLM with deterministic verification)
  - `src/tests/integration/` - Integration tests (functional verification)

---

## [4.2.10] - 2026-01-24

### Changed

- **README.md**: Major cleanup - focused on what the plugin does, not implementation details
  - Removed: Technical Principles, Tech Stack, Development Workflow, Validation Scripts, Spec File Format, Plugin Structure
  - Removed: Backend Architecture (CMDO) and Frontend Architecture (MVVM) detailed sections
  - Removed: Epics paragraph (planner agent handles this internally)
  - Simplified "Key Files in specs/" table
  - README reduced from ~365 lines to ~156 lines
  - Architecture details can be added to a separate ARCHITECTURE.md if needed

## [4.2.9] - 2026-01-24

### Changed

- **Documentation**: Updated all command examples across docs to use change directory paths
  - Fixed examples in CLAUDE.md, README.md, sdd-init.md, and project templates
  - Removed references to deleted sdd-generate-snapshot command
  - Changed `[path]` to `[change-dir]` in command tables

## [4.2.8] - 2026-01-24

### Changed

- **sdd-implement-change**: Updated to accept change directory path instead of PLAN.md file path
- **sdd-verify-change**: Updated to accept change directory path instead of SPEC.md file path

## [4.2.7] - 2026-01-24

### Removed

- **sdd-generate-snapshot command**: Removed standalone command
  - INDEX.md is already updated by `sdd-new-change` when changes are created
  - SNAPSHOT.md is updated by `sdd-init` during initialization
  - For ongoing updates, users can ask Claude to regenerate SNAPSHOT.md directly

## [4.2.6] - 2026-01-24

### Changed

- **README.md**: Consolidated "Built-in Observability" section into "Architectural Patterns"
  - Removed redundant section; observability details now in OpenTelemetry bullet point
  - Keeps README more concise

## [4.2.5] - 2026-01-24

### Changed

- **README.md**: Consolidated overlapping "Core Methodology" and "Core Principles" sections
  - Renamed "Core Principles" to "Technical Principles"
  - Removed duplicate items already covered in "Core Methodology" (specs are truth, issue tracking, git as state machine)
  - Kept unique technical principles (contract-first API, test in K8s, observable by default)

## [4.2.4] - 2026-01-24

### Fixed

- **README.md**: Removed incorrect `--components` argument from sdd-init example
  - sdd-init only supports `--name` and `--spec` arguments
  - Multi-instance setup is handled interactively during product discovery

## [4.2.3] - 2026-01-24

### Changed

- **README.md**: Moved installation instructions to marketplace README
  - Plugin README now focuses on usage and features
  - Installation lives at the marketplace level

## [4.2.2] - 2026-01-24

### Fixed

- **README.md**: Corrected agent invocation documentation
  - Removed incorrect `/agent` command syntax (not a valid Claude Code command)
  - Agents are invoked via natural language requests to Claude

## [4.2.1] - 2026-01-24

### Added

- **README.md**: Added documentation for epics (large multi-phase changes)
  - Describes when to use epics vs regular changes
  - References epic-planning skill for templates

## [4.2.0] - 2026-01-24

### Changed

- **sdd-verify-spec command**: Renamed to `/sdd-verify-change`
  - Better naming consistency with the change-centric workflow
  - Updated all references in documentation (README, CLAUDE.md)
  - Updated project scaffolding templates

## [4.1.2] - 2026-01-24

### Changed

- **Directory location**: Moved from `full-stack-spec-driven-dev/` to `plugins/sdd/`
  - Cleaner marketplace structure for multi-plugin support
  - No changes to plugin functionality

## [4.1.1] - 2026-01-24

### Removed

- **QUICKSTART.md**: Merged into README.md to consolidate documentation
  - Added agent invocation syntax table
  - Added workflow diagram
  - Added multiple components example
  - Added plugin structure section
  - Removed redundant content

## [4.1.0] - 2026-01-24

### Changed

- **sdd-implement-plan command**: Renamed to `/sdd-implement-change`
  - Better naming consistency with the change-centric workflow
  - Updated all references in documentation (README, QUICKSTART, CLAUDE.md)
  - Updated project scaffolding templates
  - Updated sdd-init command output messages

## [4.0.0] - 2026-01-24

### Changed

- **sdd-init command**: Complete redesign of initialization workflow
  - **Phase 1**: New Product Discovery phase with adaptive questioning
    - Opens with broad question about what user is building
    - Adaptively asks follow-ups only for missing information
    - Extracts users, workflows, entities, scope, and integrations
    - Never asks more than 4-5 questions total
    - Respects users who want to skip discovery
  - **Phase 2**: Recommendation-based component selection
    - Recommends components based on discovered product needs
    - Justifies each component with specific product context
    - Replaces preset options (A/B/C/D/E) with intelligent recommendations
  - **Phase 3**: Enhanced configuration summary
    - Shows product context alongside technical configuration
    - Displays what will be pre-populated (glossary, personas, use-cases)
  - **Phase 5**: New domain knowledge population step
    - Pre-populates glossary with discovered entities
    - Creates entity definition stubs in `specs/domain/definitions/`
    - Creates use-case stubs in `specs/domain/use-cases/`
    - Updates SNAPSHOT.md with product overview

### Rationale

The previous workflow jumped from "name + one-liner + domain word" to component selection without understanding what the user was building. The new discovery-first approach:
- Understands the product before making technical recommendations
- Pre-populates specs with discovered domain knowledge
- Creates more relevant, context-aware project scaffolds
- Reduces manual work filling in boilerplate domain documentation
