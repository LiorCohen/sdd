# Changelog - Version 5.x

All notable changes for major version 5 of the SDD plugin.

---

## [5.3.0] - 2026-01-30

### Added

- **Unified CLI System (Task 62)**: Consolidated all plugin TypeScript into `plugin/system/`
  - New `sdd-system` CLI with namespaced commands: scaffolding, spec, version, hook, database, contract
  - Single entry point replaces scattered scripts in `plugin/scripts/` and skill directories
  - Unified build process using npm workspaces
  - Type-safe command handlers with consistent error handling
  - JSON output mode (`--json`) for all commands
  - Source maps for debugging

- **`/sdd-run` command**: Unified user-facing entry point for CLI operations
  - Single command for all namespaces: `/sdd-run <namespace> <action> [args]`
  - Examples: `/sdd-run database migrate my-db`, `/sdd-run spec validate --all`

- **JSON Schema validation**: All command handlers have embedded schemas
  - Type-safe argument validation with clear error messages
  - Auto-generated help text from schema descriptions
  - New `schema-validator.ts` utility in `plugin/system/src/lib/`

### Changed

- **Hooks architecture**: Shell hook scripts converted to TypeScript
  - Single thin `hook-runner.sh` wrapper delegates to `sdd-system hook <name>`
  - All hook logic now type-safe and testable in TypeScript
  - `hooks.json` updated to use new hook-runner.sh entry point

- **Skill references updated**: SKILL.md files now reference CLI commands
  - `scaffolding/SKILL.md`: Uses `sdd-system scaffolding project`
  - `domain-population/SKILL.md`: Uses `sdd-system scaffolding domain`
  - `spec-index/SKILL.md`: Uses `sdd-system spec validate|index|snapshot`

### Removed

- **Deleted files** (migrated to `plugin/system/`):
  - `plugin/scripts/` directory (5 TypeScript files)
  - `plugin/skills/scaffolding/scaffolding.ts`
  - `plugin/skills/domain-population/domain-population.ts`
  - `plugin/hooks/validate-sdd-writes.sh`
  - `plugin/hooks/prompt-commit-after-write.sh`
  - `plugin/package.json` and `plugin/tsconfig.json`

### Rationale

Consolidating all TypeScript into a unified CLI improves maintainability, testability, and provides a consistent interface for all plugin operations. This supersedes tasks #58 (shell→TS) and #61 (consolidate TS files).

---

## Infrastructure - 2026-01-29

### Changed

- **Repository references**: Updated all documentation to reflect new repo name `LiorCohen/sdd`
  - README.md: Updated marketplace installation URL
  - CLAUDE.md: Updated directory structure reference
  - CONTRIBUTING.md: Updated directory structure reference

---

## [5.2.0] - 2026-01-29

### Added

- **PostToolUse hook for commit prompts (Task 49)**: Prevent data loss from uncommitted changes
  - New `prompt-commit-after-write.sh` hook fires after Write/Edit to SDD-managed directories
  - Covers: `changes/`, `specs/`, `components/`, `config/`, `tests/`
  - Outputs reminder message: "Created/Modified X in Y. Consider committing to prevent data loss."
  - Registered in `hooks.json` alongside existing PreToolUse validation hook

### Changed

- **sdd-new-change command**: Added Step 6 (Commit) with commit-standards format
  - Automatically commits spec and plan after user confirms
  - Includes error handling if commit fails (retry, skip, investigate)
- **sdd-init command**: Updated Phase 8 with commit-standards message format
  - Proper structured commit message with component count and domain
  - Error handling for commit failures

### Enhanced

- **permissions.md documentation**: Documented both PreToolUse and PostToolUse hooks
  - Added troubleshooting for "Too Many Commit Reminders"
  - Added test commands for both hooks

---

## Infrastructure - 2026-01-29

### Fixed

- **GitHub Actions release workflow**: Fixed to read from `changelog/vN.md` instead of deleted `CHANGELOG.md`
- **GitHub Actions release workflow**: Fixed awk changelog extraction to stop at `---` separators
- **GitHub Actions release workflow**: Added check to skip if release already exists

### Changed

- **GitHub Actions release workflow**: Now creates release archives with only plugin files
  - Includes `plugin/` and `.claude-plugin/` directories only
  - Uploads both `.tar.gz` and `.zip` archives to release
- **GitHub Actions release workflow**: Added debug output for version comparison

---

## [5.1.0] - 2026-01-29

### Added

- **commit-standards skill (Task 18)**: Commit guidance for SDD projects
  - Conventional commit format with Actions: Add, Fix, Update, Remove, Refactor, Docs, Tasks
  - Changelog standards with split directory structure (`changelog/vN.md`)
  - Version bump guidelines (PATCH/MINOR/MAJOR)
  - SDD-aware practices: reference change directories, commit after phases
  - Critical rule: commit after every filesystem change to prevent data loss
  - Co-Authored-By footer with SDD Plugin version (verified with user)

---

## [5.0.1] - 2026-01-29

### Enhanced

- **typescript-standards skill (Task 45)**: Added banned mutable operations section
  - Banned: `.push()`, `.pop()`, `.shift()`, `.unshift()`, `.splice()`, `.sort()`, `.reverse()`, `.fill()`
  - Banned object mutations: `obj.prop = value`, `delete obj.prop`, `Object.assign()`
  - Banned Map/Set mutations: `.set()`, `.delete()`, `.add()`, `.clear()`
  - Documented alternatives using spread operators, `reduce`, `flatMap`, `toSorted()`, `toReversed()`

### Changed

- **Refactor: Immutable patterns across codebase**: Full compliance with typescript-standards
  - `scaffolding.ts`: Rewrote with `mergeItems`, `reduce`, `flatMap`, `Object.fromEntries`
  - `domain-population.ts`: Converted to `Promise.all`, `reduce` for parallel operations
  - `generate-snapshot.ts`, `generate-index.ts`: Replaced loops with `reduce`, `flatMap`
  - `validate-spec.ts`: Refactored to return arrays using `filter`/`map`
  - `spec-utils.ts`: Rewrote `walkDir` using `Promise.all` and `.flat()`
  - Test files: Applied same patterns, created collector closures for stream handling

---

## Infrastructure - 2026-01-29

### Added

- **GitHub Actions release workflow (Task 51)**: Automated releases on plugin version changes
  - Workflow at `.github/workflows/release.yml`
  - Triggers on push to main, compares version in `.claude-plugin/marketplace.json`
  - Extracts changelog entry for the version using awk
  - Creates GitHub release with `v{version}` tag via `gh release create`
  - No third-party actions - uses only `actions/checkout@v4` and GitHub CLI

- **Split CHANGELOG into per-major-version files (Task 55)**: File size exceeded Claude's limit
  - Created `changelog/` directory with `index.md` and `v1.md` through `v5.md`
  - Root `CHANGELOG.md` now serves as index with version table + latest entries
  - Updated commit skill to document two-file changelog update requirement
  - Each major version's full history preserved in dedicated file

---

## [5.0.0] - 2026-01-28

### Changed

- **BREAKING: Directory restructure (Task 9)**: Change specs now live at project root
  - `specs/changes/` → `changes/` (change specifications)
  - `specs/external/` → `archive/` (archived external specs, audit only)
  - Added `.claudeignore` with `archive/` ignored
  - Added `.gitkeep` files for empty directories

- **BREAKING: Remove greetings example**: Clean slate approach for new projects
  - Deleted all greeting-related files from backend, frontend, and contract templates
  - Empty barrel exports with helpful comments guide users to add their own features
  - User's first feature IS the example

- **Backend templates**: PostgreSQL database support
  - Replaced in-memory database hack with real PostgreSQL using `pg` package
  - Added `databaseUrl` to config
  - Added `pg` and `@types/pg` dependencies

- **Simplified completion reports**: Focus on next steps
  - Without external spec: guides to `/sdd-new-change`
  - With external spec: lists created changes and guides to `/sdd-implement-change`

### Rationale

The greetings example violated SDD principles (code with no spec) and the in-memory database masked real requirements. A clean skeleton with helpful comments is more honest and practical - the user's first feature becomes the learning example.

---

## Infrastructure - 2026-01-28

### Added

- **Task management skill (Task 19)**: New marketplace skill at `.claude/skills/tasks/`
  - Commands: `/tasks`, `/tasks add`, `/tasks complete`, `/tasks merge`, `/tasks prioritize`, `/tasks plan`, `/tasks plans`
  - Manage backlog, track progress, create implementation plans
  - Reorganized task data into `tasks/` directory (TASKS.md + plans/)

- **Task 9 plan**: Comprehensive plan for ready-to-work components
  - Merge Task #42 (restructure specs directory) into Task #9
  - 9 files to delete, 6 to create, 39 to modify
  - Remove greetings example, use PostgreSQL via k8s, restructure specs directory

- **Task 51 plan**: GitHub Actions workflow for automated releases
  - Create releases on plugin version changes
  - Extract changelog entry as release notes

### Changed

- **Commit skill**: Added Step 4 "Tasks & Plans Check" to verify tasks and plans are updated before committing
  - Checks if commit completes a task
  - Verifies plan status is updated
  - Prompts for new tasks when follow-up work is needed
