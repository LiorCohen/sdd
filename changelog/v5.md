# Changelog - Version 5.x

All notable changes for major version 5 of the SDD plugin.

---

## [5.8.0] - 2026-02-01

### Changed

- **project-settings**: Move settings file from `sdd-settings.yaml` to `.sdd/sdd-settings.yaml`
  - Consolidates all SDD metadata into `.sdd/` directory
  - Backwards compatible: legacy root location still works with deprecation warning
  - Added migration guide with quick command: `mkdir -p .sdd && mv sdd-settings.yaml .sdd/`

- **validate-write hook**: Added `.sdd/` to safe directories for auto-approval

- **recommended-permissions.json**: Added `Write(.sdd/**)` and `Edit(.sdd/**)` patterns

### Updated

- **26 files updated** to reference new `.sdd/sdd-settings.yaml` path:
  - Runtime: `config.ts`, `validate-write.ts`, `recommended-permissions.json`
  - Commands: `sdd-init`, `sdd-new-change`, `sdd-implement-change`
  - Skills: 8 skill files (planning, change-creation, commit-standards, etc.)
  - Agents: 6 agent files (backend-dev, frontend-dev, api-designer, etc.)
  - Documentation: `getting-started.md`, `components.md`
  - Project template: `templates/project/CLAUDE.md`
  - Tests: 2 test files

### Rationale

The `.sdd/` directory will consolidate all SDD metadata:
- `sdd-settings.yaml` - project configuration (this release)
- Future: `checksums.yaml` for drift detection (#35)
- Future: `state.yaml` for command session state (#66)

---

## [5.7.3] - 2026-01-31

### Changed

- **sdd-run command**: Refocused documentation on user-facing operations
  - Database operations (setup, migrate, seed, reset, psql, port-forward, teardown)
  - Contract validation
  - Added "When to Use" section explaining distinction from workflow commands
  - Marked internal namespaces (scaffolding, spec, version, hook) as not for direct use

### Fixed

- **tutorial.md**: Corrected troubleshooting section that incorrectly directed users to run internal `contract generate-types` command

---

## [5.7.2] - 2026-01-31

### Fixed

- **plugin.json**: Corrected hooks path from `../hooks/hooks.json` to `./hooks/hooks.json`
  - Paths must be relative to plugin root, not to `.claude-plugin/` directory

---

## Infrastructure - 2026-02-01

### Added

- **tutorial.md**: End-to-end tutorial for building a restaurant management system
  - Covers full SDD workflow: init → new-change → implement → verify → run
  - Focused on commands and workflow, not generated code details

---

## Infrastructure - 2026-01-31

### Added

- **manifest-validation skill**: Validates plugin/marketplace manifests before commits
  - 8 validation checks grounded in Claude Code Plugins Reference v2.1.27
  - Integrated into commit skill as Step 2.5

- **README logo**: Added SDD logo to README header

### Fixed

- **Documentation**: Corrected inaccuracies in plugin documentation
  - Removed non-existent `spec-writer` and `planner` agents from README and docs/agents.md
  - Changed agent count from 10 to 8 to reflect actual plugin state
  - Rewrote `/sdd-run` command documentation to match actual sdd-system CLI functionality
  - Added missing `/sdd-run` to README commands table

---

## [5.7.1] - 2026-01-31

### Added

- **Standards Skills**: Complete coverage for all component types
  - `contract-standards`: OpenAPI patterns, type generation, versioning
  - `database-standards`: Migration/seed patterns, PostgreSQL conventions
  - `testing-standards`: Unit/integration/e2e patterns, AAA structure
  - `cicd-standards`: GitHub Actions workflows, job structure, secrets

- **Config Schemas in Scaffolders**: Each scaffolder now documents its config schema
  - `backend-scaffolding`: port, probesPort, logLevel + database extension
  - `frontend-scaffolding`: apiBaseUrl + features extension
  - `database-scaffolding`: host, port, name, user, passwordSecret, pool
  - `helm-scaffolding`: Helm values file schema

### Changed

- **backend-standards**: Added implementation order guidelines (Contract → Model → DAL → Controller)
- **Standards reference scaffolders**: Config schemas moved from standards to scaffolders to avoid duplication

---

## [5.7.0] - 2026-01-31

### Changed

- **Planning System Architecture**: Major refactor for clearer separation of concerns (Task 64)
  - Removed `planner` and `spec-writer` agents (merged into `change-creation` skill)
  - SPEC.md is now a thorough, self-sufficient technical specification
  - PLAN.md focused on execution with implementation state tracking
  - Domain documentation specified upfront in SPEC.md (not discovered during implementation)
  - Dynamic phase generation from `sdd-settings.yaml` based on affected components
  - Resource usage tracking (tokens, turns, duration per phase) for cost and time estimation
  - Implementation state enables session resumption from any point

### Added

- **Comprehensive SPEC.md Templates**: Thorough tech specs for all change types
  - Feature: Full technical design with architecture, data model, API contracts, security, observability
  - Bugfix: Root cause analysis, regression test requirements
  - Refactor: Current state analysis, behavior preservation, transformation plan

- **PLAN.md Implementation State**: Track progress for session resumption
  - Expected vs actual files changed
  - Phase completion status
  - Blockers tracking
  - Resource usage (tokens, turns, duration) per phase

### Rationale

Skills (main context) handle interactive planning with user input. Agents (subagent) handle non-interactive execution only. This separation clarifies responsibilities and improves the planning workflow.

---

## Infrastructure - 2026-01-31

### Changed

- **Tasks Skill**: Complete restructure with colocated task/plan folders
  - Each task is now a folder (`<status-dir>/<id>/`) containing `task.md` and `plan.md`
  - Removed separate `issues/` and `plans/` directories
  - Added numbered status directories: 1-inbox through 8-consolidated
  - New statuses: `planning`, `ready`, `reviewing` for better workflow tracking
  - Priority is now frontmatter-only (no priority directories)
  - Automatic status updates based on user instructions
  - Branch-before-implementing rule enforced
  - Auto-move-to-reviewing after implementation complete
  - Renamed `issue.md` to `task.md` for consistent terminology

---

## [5.6.0] - 2026-01-31

### Changed

- **External Spec Handling**: Move from `sdd-init` to `sdd-new-change` (Task 65)
  - `/sdd-new-change --spec <path>` now handles external spec imports
  - `/sdd-init` no longer accepts `--spec` argument (focuses on project initialization)
  - Better separation of concerns: init = scaffolding, new-change = change creation
  - External specs can now be imported at any time, not just during initialization
  - Updated `external-spec-integration` skill to reference new command
  - Updated `product-discovery` skill to remove spec-related parameters
  - Fixed `archive/` path references (was incorrectly `external/` in some places)
  - Updated project scaffolding template with new command documentation

### Rationale

External spec import is fundamentally about creating changes, not initializing projects. Moving it to `sdd-new-change` allows users to import external specs into existing projects at any time, improving flexibility.

---

## [5.5.0] - 2026-01-31

### Added

- **Config Component Architecture**: Complete config management system (Task 11)
  - `config-scaffolding` skill with templates for envs/, schemas/, types/
  - `config-standards` skill documenting YAML config best practices
  - `/sdd-config` command for generate, validate, diff, add-env operations
  - `sdd-system config` CLI namespace with all config operations
  - Config is now a mandatory singleton component at `components/config/`

- **Helm Component Support**: Kubernetes deployment scaffolding
  - `helm-scaffolding` skill with Chart.yaml and values.yaml templates
  - `helm-standards` skill documenting Helm best practices
  - Integration with config component for environment-specific values

- **Functional Config Tests**: 59 tests covering config command behavior
  - deep-merge algorithm tests (23 tests)
  - generate command tests (13 tests)
  - validate command tests (11 tests)
  - diff command tests (12 tests)

- **Config Guide Documentation**: `docs/config-guide.md` explaining config system

### Changed

- **Backend Templates**: Updated to use YAML config instead of dotenv
  - `load_config.ts` now reads from `SDD_CONFIG_PATH` environment variable
  - Removed dotenv dependency from backend template

- **Component Recommendation**: Config is now mandatory first component
  - All examples updated to show config scaffolding first
  - Dependency table shows config as prerequisite for all components

- **Project Scaffolding**: Removed legacy config templates
  - Config is now scaffolded via dedicated `config-scaffolding` skill
  - Environment layering (default → env) instead of flat config files

### Fixed

- **Ajv Schema Validation**: Removed `$schema` property before compilation
  - Default ajv doesn't support 2020-12 draft meta-schema
  - Validation now works correctly with all JSON Schema versions

### Rationale

Configuration was scattered across dotenv files with no schema validation.
The new config component provides typed, validated, environment-layered
configuration with IDE support via YAML Language Server.

---

## [5.4.1] - 2026-01-30

### Changed

- **Permissions Documentation**: Moved to colocate with hooks
  - `plugin/docs/permissions.md` → `plugin/hooks/PERMISSIONS.md`
  - `plugin/config/recommended-permissions.json` → `plugin/hooks/recommended-permissions.json`
  - Updated references in README.md, sdd-init.md, sdd-new-change.md

### Rationale

Colocation improves discoverability. Permissions config and docs belong next to the hooks
that use them, not in separate plugin/docs/ and plugin/config/ directories.

---

## [5.4.0] - 2026-01-30

### Added

- **TypeScript Standards Conformance Test**: Automated enforcement of import standards
  - Validates no `.js`/`.ts` extensions in imports
  - Validates no deep relative imports (3+ levels of `../`)
  - Ensures both typescript-standards skill files stay in sync
  - Checks for no default exports and no CommonJS usage

- **Path Alias System**: `@/` prefix for clean imports across plugin and tests
  - tsconfig.json `paths` configuration: `@/*` → `src/*`
  - Vitest alias configuration for test runtime
  - Eliminates deep relative import chains

### Changed

- **TypeScript Configuration**: Modernized compiler settings
  - `moduleResolution: "NodeNext"` → `"Bundler"` (no extensions required)
  - Added `baseUrl` and `paths` for alias support
  - Frontend template tsconfig standardized with same patterns

- **All Imports Standardized**: 57 files updated across plugin and tests
  - Removed all `.js` extensions from imports
  - Converted deep relative imports to `@/` aliases
  - Consistent import style throughout codebase

- **typescript-standards Skill**: Added new import rules documentation
  - "No File Extensions in Imports" section
  - "Path Aliases for Deep Imports" section
  - Updated summary checklist

### Rationale

Standardizing imports improves maintainability and reduces cognitive load. The `@/` alias
makes file locations clear at a glance, and eliminating extensions aligns with modern
bundler-based TypeScript workflows.

---

## Infrastructure - 2026-01-30

### Fixed

- **GitHub Actions release workflow**: Fixed corrupted release notes caused by shell escaping
  - Changelog content with backticks was being interpreted as command substitution
  - Now writes to file and uses `--notes-file` instead of passing through shell variables

### Changed

- **GitHub Actions release workflow**: Always ensures release exists for current version
  - Creates release if version changed OR if no release exists
  - Handles cases where previous workflow runs failed or releases were deleted

---

## [5.3.0] - 2026-01-30

### Added

- **Unified CLI System (Task 62)**: Consolidated all plugin TypeScript into `plugin/system/`
  - New `sdd-system` CLI with namespaced commands: scaffolding, spec, version, hook, database, contract
  - Single entry point replaces scattered scripts in `plugin/scripts/` and skill directories
  - Unified build process using npm workspaces
  - Type-safe command handlers with consistent error handling
  - JSON output mode (`--json`) for all commands
  - Source maps for debugging

- **`/sdd-run` command**: Unified user-facing entry point for CLI operations
  - Single command for all namespaces: `/sdd-run <namespace> <action> [args]`
  - Examples: `/sdd-run database migrate my-db`, `/sdd-run spec validate --all`

- **JSON Schema validation**: All command handlers have embedded schemas
  - Type-safe argument validation with clear error messages
  - Auto-generated help text from schema descriptions
  - New `schema-validator.ts` utility in `plugin/system/src/lib/`

### Changed

- **Hooks architecture**: Shell hook scripts converted to TypeScript
  - Single thin `hook-runner.sh` wrapper delegates to `sdd-system hook <name>`
  - All hook logic now type-safe and testable in TypeScript
  - `hooks.json` updated to use new hook-runner.sh entry point

- **Skill references updated**: SKILL.md files now reference CLI commands
  - `scaffolding/SKILL.md`: Uses `sdd-system scaffolding project`
  - `domain-population/SKILL.md`: Uses `sdd-system scaffolding domain`
  - `spec-index/SKILL.md`: Uses `sdd-system spec validate|index|snapshot`

### Removed

- **Deleted files** (migrated to `plugin/system/`):
  - `plugin/scripts/` directory (5 TypeScript files)
  - `plugin/skills/scaffolding/scaffolding.ts`
  - `plugin/skills/domain-population/domain-population.ts`
  - `plugin/hooks/validate-sdd-writes.sh`
  - `plugin/hooks/prompt-commit-after-write.sh`
  - `plugin/package.json` and `plugin/tsconfig.json`

### Rationale

Consolidating all TypeScript into a unified CLI improves maintainability, testability, and provides a consistent interface for all plugin operations. This supersedes tasks #58 (shell→TS) and #61 (consolidate TS files).

---

## Infrastructure - 2026-01-29

### Changed

- **Repository references**: Updated all documentation to reflect new repo name `LiorCohen/sdd`
  - README.md: Updated marketplace installation URL
  - CLAUDE.md: Updated directory structure reference
  - CONTRIBUTING.md: Updated directory structure reference

---

## [5.2.0] - 2026-01-29

### Added

- **PostToolUse hook for commit prompts (Task 49)**: Prevent data loss from uncommitted changes
  - New `prompt-commit-after-write.sh` hook fires after Write/Edit to SDD-managed directories
  - Covers: `changes/`, `specs/`, `components/`, `config/`, `tests/`
  - Outputs reminder message: "Created/Modified X in Y. Consider committing to prevent data loss."
  - Registered in `hooks.json` alongside existing PreToolUse validation hook

### Changed

- **sdd-new-change command**: Added Step 6 (Commit) with commit-standards format
  - Automatically commits spec and plan after user confirms
  - Includes error handling if commit fails (retry, skip, investigate)
- **sdd-init command**: Updated Phase 8 with commit-standards message format
  - Proper structured commit message with component count and domain
  - Error handling for commit failures

### Enhanced

- **permissions.md documentation**: Documented both PreToolUse and PostToolUse hooks
  - Added troubleshooting for "Too Many Commit Reminders"
  - Added test commands for both hooks

---

## Infrastructure - 2026-01-29

### Fixed

- **GitHub Actions release workflow**: Fixed to read from `changelog/vN.md` instead of deleted `CHANGELOG.md`
- **GitHub Actions release workflow**: Fixed awk changelog extraction to stop at `---` separators
- **GitHub Actions release workflow**: Added check to skip if release already exists

### Changed

- **GitHub Actions release workflow**: Now creates release archives with only plugin files
  - Includes `plugin/` and `.claude-plugin/` directories only
  - Uploads both `.tar.gz` and `.zip` archives to release
- **GitHub Actions release workflow**: Added debug output for version comparison

---

## [5.1.0] - 2026-01-29

### Added

- **commit-standards skill (Task 18)**: Commit guidance for SDD projects
  - Conventional commit format with Actions: Add, Fix, Update, Remove, Refactor, Docs, Tasks
  - Changelog standards with split directory structure (`changelog/vN.md`)
  - Version bump guidelines (PATCH/MINOR/MAJOR)
  - SDD-aware practices: reference change directories, commit after phases
  - Critical rule: commit after every filesystem change to prevent data loss
  - Co-Authored-By footer with SDD Plugin version (verified with user)

---

## [5.0.1] - 2026-01-29

### Enhanced

- **typescript-standards skill (Task 45)**: Added banned mutable operations section
  - Banned: `.push()`, `.pop()`, `.shift()`, `.unshift()`, `.splice()`, `.sort()`, `.reverse()`, `.fill()`
  - Banned object mutations: `obj.prop = value`, `delete obj.prop`, `Object.assign()`
  - Banned Map/Set mutations: `.set()`, `.delete()`, `.add()`, `.clear()`
  - Documented alternatives using spread operators, `reduce`, `flatMap`, `toSorted()`, `toReversed()`

### Changed

- **Refactor: Immutable patterns across codebase**: Full compliance with typescript-standards
  - `scaffolding.ts`: Rewrote with `mergeItems`, `reduce`, `flatMap`, `Object.fromEntries`
  - `domain-population.ts`: Converted to `Promise.all`, `reduce` for parallel operations
  - `generate-snapshot.ts`, `generate-index.ts`: Replaced loops with `reduce`, `flatMap`
  - `validate-spec.ts`: Refactored to return arrays using `filter`/`map`
  - `spec-utils.ts`: Rewrote `walkDir` using `Promise.all` and `.flat()`
  - Test files: Applied same patterns, created collector closures for stream handling

---

## Infrastructure - 2026-01-29

### Added

- **GitHub Actions release workflow (Task 51)**: Automated releases on plugin version changes
  - Workflow at `.github/workflows/release.yml`
  - Triggers on push to main, compares version in `.claude-plugin/marketplace.json`
  - Extracts changelog entry for the version using awk
  - Creates GitHub release with `v{version}` tag via `gh release create`
  - No third-party actions - uses only `actions/checkout@v4` and GitHub CLI

- **Split CHANGELOG into per-major-version files (Task 55)**: File size exceeded Claude's limit
  - Created `changelog/` directory with `index.md` and `v1.md` through `v5.md`
  - Root `CHANGELOG.md` now serves as index with version table + latest entries
  - Updated commit skill to document two-file changelog update requirement
  - Each major version's full history preserved in dedicated file

---

## [5.0.0] - 2026-01-28

### Changed

- **BREAKING: Directory restructure (Task 9)**: Change specs now live at project root
  - `specs/changes/` → `changes/` (change specifications)
  - `specs/external/` → `archive/` (archived external specs, audit only)
  - Added `.claudeignore` with `archive/` ignored
  - Added `.gitkeep` files for empty directories

- **BREAKING: Remove greetings example**: Clean slate approach for new projects
  - Deleted all greeting-related files from backend, frontend, and contract templates
  - Empty barrel exports with helpful comments guide users to add their own features
  - User's first feature IS the example

- **Backend templates**: PostgreSQL database support
  - Replaced in-memory database hack with real PostgreSQL using `pg` package
  - Added `databaseUrl` to config
  - Added `pg` and `@types/pg` dependencies

- **Simplified completion reports**: Focus on next steps
  - Without external spec: guides to `/sdd-new-change`
  - With external spec: lists created changes and guides to `/sdd-implement-change`

### Rationale

The greetings example violated SDD principles (code with no spec) and the in-memory database masked real requirements. A clean skeleton with helpful comments is more honest and practical - the user's first feature becomes the learning example.

---

## Infrastructure - 2026-01-28

### Added

- **Task management skill (Task 19)**: New marketplace skill at `.claude/skills/tasks/`
  - Commands: `/tasks`, `/tasks add`, `/tasks complete`, `/tasks merge`, `/tasks prioritize`, `/tasks plan`, `/tasks plans`
  - Manage backlog, track progress, create implementation plans
  - Reorganized task data into `tasks/` directory (TASKS.md + plans/)

- **Task 9 plan**: Comprehensive plan for ready-to-work components
  - Merge Task #42 (restructure specs directory) into Task #9
  - 9 files to delete, 6 to create, 39 to modify
  - Remove greetings example, use PostgreSQL via k8s, restructure specs directory

- **Task 51 plan**: GitHub Actions workflow for automated releases
  - Create releases on plugin version changes
  - Extract changelog entry as release notes

### Changed

- **Commit skill**: Added Step 4 "Tasks & Plans Check" to verify tasks and plans are updated before committing
  - Checks if commit completes a task
  - Verifies plan status is updated
  - Prompts for new tasks when follow-up work is needed
