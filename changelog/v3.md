# Changelog - Version 3.x

All notable changes for major version 3 of the SDD plugin.

---

## [3.10.0] - 2026-01-24

### Changed

- **Scripts**: Migrated all Python scripts to TypeScript
  - `validate-spec.ts`, `generate-index.ts`, `generate-snapshot.ts`
  - Consolidated duplicated `parse_frontmatter()` into `scripts/lib/frontmatter.ts`
  - Added `scripts/lib/spec-utils.ts` for shared utilities
  - Scripts run via `npx ts-node --esm` (no build step required)

- **Scaffolding skill**: Migrated `scaffolding.py` to `scaffolding.ts`
  - Same functionality, TypeScript implementation
  - Updated SKILL.md with TypeScript invocation examples

### Added

- **TypeScript configuration**: Plugin-level TypeScript support
  - `package.json` with npm scripts for all utilities
  - `tsconfig.json` with strict settings, ESM modules

### Removed

- **Python scripts**: Deleted all Python files from plugin
  - `validate-spec.py`, `generate-index.py`, `generate-snapshot.py`
  - `scaffolding.py`

### Rationale

Reduces environment dependencies - developers already have Node.js and TypeScript installed. No Python required to use the plugin.

## [3.9.0] - 2026-01-24

### Added

- **database-scaffolding skill**: New component type for PostgreSQL database scaffolding
  - Creates `components/database/` with migrations, seeds, and scripts directories
  - Includes `package.json` with npm scripts for migrate, seed, and reset
  - `migrations/001_initial_schema.sql` template with transaction support
  - `seeds/001_seed_data.sql` template demonstrating idempotent patterns
  - Shell scripts: `migrate.sh`, `seed.sh`, `reset.sh` with safety checks
  - `README.md` with usage documentation

- **sdd-init command**: Added "Backend with Database" project type (Option C)
  - Scaffolds contract, server, database, config, testing, and cicd components
  - Database component listed in component dependencies table

- **database component tests**: 30 unit tests covering database scaffolding
  - Skill structure validation
  - Template content verification
  - Scaffolding script integration tests
  - Documentation consistency checks

### Changed

- **scaffolding skill**: Updated to support database component
  - Added database-scaffolding to architecture table
  - Added to available components and presets
  - Updated scaffolding order documentation

- **project-settings skill**: Added database to settings schema
  - Single-instance boolean component (like config, helm)
  - Added to component format documentation

- **planner agent**: Added Database to standard components table
- **backend-dev agent**: Added database component awareness and workflow guidance
- **devops agent**: Added database deployment patterns for Kubernetes

---

## Infrastructure - 2026-01-23

### Changed

- **Test structure**: Moved plugin tests from `full-stack-spec-driven-dev/tests/` to `tests/sdd/`
  - Tests are now at marketplace level, organized by plugin name
  - Plugin directory no longer contains tests

### Added

- **TypeScript LSP**: Added project-bundled TypeScript language server
  - Created `.claude/cclsp.json` for Claude Code LSP configuration
  - Uses local `node_modules` via `npx` (no global installation required)

- **TypeScript standards skill**: Copied to marketplace level (`.claude/skills/typescript-standards/`)
  - Used when writing TypeScript templates
  - Ensures strict, immutable, type-safe code

---

## [3.8.0] - 2026-01-23

### Added

- **postgresql skill**: New SQL-native PostgreSQL database skill
  - SKILL.md with quick reference for common operations
  - 8 reference files covering all major PostgreSQL topics:
    - `deployment.md`: Docker, Docker Compose, Kubernetes deployment
    - `schema-management.md`: Tables, indexes, migrations, partitioning
    - `seed-data.md`: INSERT, COPY, generate_series, test data
    - `permissions-setup.md`: Roles, grants, row-level security
    - `system-views.md`: pg_stat_* monitoring views
    - `introspection-queries.md`: Schema exploration queries
    - `performance-tuning.md`: EXPLAIN, index strategy, configuration
    - `common-errors.md`: Error messages and solutions
  - Version compatibility notes (PostgreSQL 12+)
  - Safety guidelines for production use

- **postgresql tests**: Real usage scenario tests with Docker
  - Deploy PostgreSQL via Docker Compose
  - Create and execute schema migrations
  - Set up roles and permissions
  - Seed data generation
  - Query performance analysis with EXPLAIN
  - Schema introspection
  - Backup script generation

## [3.7.1] - 2026-01-23

### Fixed

- **change-creation skill**: Corrected invalid agent names in plan templates
  - `domain-expert` → `spec-writer`
  - `contract-author` → `api-designer`
  - `backend-developer` → `backend-dev`
  - `frontend-developer` → `frontend-dev`
  - `test-engineer` → `tester`

## [3.7.0] - 2026-01-23

### Added

- **epic-planning skill**: New skill for managing large changes
  - EPIC.md template for epic-level planning
  - Phase-based directory structure (phases/01-contract/, etc.)
  - PR size guidelines (target <400, max 800 lines per PR)
  - Escalation criteria from planning skill

- **backend-scaffolding skill**: New skill with colocated server templates
  - CMDO architecture scaffolding
  - Multi-instance support (server:api, server:worker)
  - Templates moved from templates/components/server/

- **frontend-scaffolding skill**: New skill with colocated webapp templates
  - MVVM architecture scaffolding
  - Multi-instance support (webapp:admin, webapp:public)
  - Templates moved from templates/components/webapp/

- **contract-scaffolding skill**: New skill with colocated contract templates
  - OpenAPI scaffolding and type generation setup
  - Templates moved from templates/components/contract/

- **project-scaffolding skill**: New skill with colocated project templates
  - Root files (README.md, CLAUDE.md, package.json)
  - Specs directory structure
  - Config component templates
  - Templates moved from templates/project/, templates/specs/, templates/components/config/

### Changed

- **scaffolding skill**: Now orchestrates component-specific scaffolding skills
  - Uses `skills_dir` config instead of `template_dir`
  - Legacy support for backward compatibility

- **scaffolding.py**: Updated to use skill-specific template directories
  - ParsedComponent type for multi-instance parsing
  - Component naming: `type:name` format (e.g., server:api → server-api/)

- **project-settings skill**: Added multi-instance component support
  - `server` and `webapp` can be boolean OR list of names
  - Added `get_component_dirs` operation

- **planner agent**: Added epic-planning skill reference and multi-component awareness

- **planning skill**: Added PR size guidelines and escalation to epic-planning

- **spec-decomposition skill**: Added EPIC complexity level and `requires_epic` field

- **sdd-init command**: Updated for multi-component initialization

- **backend-dev, frontend-dev agents**: Added multi-instance working directory notes

- **api-designer agent**: Updated type generation paths for multi-instance

- **devops agent**: Added multi-component support section

- **Documentation**: Updated CLAUDE.md, README.md, QUICKSTART.md
  - Standardized on "CMDO architecture" terminology (was "5-layer")
  - Updated skills listing
  - Added multi-component examples

### Removed

- **templates/ directory**: Moved to skill-specific locations
  - Templates now colocated with their scaffolding skills
  - Better organization and maintainability

### Rationale

This release restructures scaffolding to improve maintainability by colocating templates with their skills, adds support for multiple server/webapp instances in a single project, and introduces epic-level planning for managing large changes that span multiple PRs.

## [3.6.1] - 2026-01-23

### Changed

- **tester agent**: Enhanced with content from removed testing skill
  - Added directory structure, Testkube commands, spec/issue reference pattern
  - References integration-testing and e2e-testing skills only
  - Clarified focus on integration and E2E tests (unit tests by implementors)

### Removed

- **testing skill**: Removed redundant overview skill
  - Content merged into tester agent and specialized skills
  - Three specialized skills (unit-testing, integration-testing, e2e-testing) now cover all patterns

## [3.6.0] - 2026-01-23

### Added

- **unit-testing skill**: New specialized skill for unit testing patterns
  - Mocking strategies (dependency injection, vi.fn, vi.mock)
  - Fixtures and factory functions
  - Test isolation and state management
  - Async testing patterns
  - Discriminated union testing
  - Coverage guidelines and targets

- **integration-testing skill**: New specialized skill for integration testing
  - Database setup and teardown strategies
  - Cleanup patterns (transaction rollback, truncate, surgical delete)
  - API client setup and authentication helpers
  - Seed data management
  - Contract testing
  - Testkube configuration

- **e2e-testing skill**: New specialized skill for end-to-end testing
  - Playwright configuration
  - Page Object Model patterns
  - Test data management via API
  - Visual regression testing
  - Async operation handling
  - Test attributes (`data-testid`)

### Changed

- **backend-dev agent**: Added `unit-testing` skill reference
  - Clarified that backend-dev writes unit tests (not tester agent)

- **frontend-dev agent**: Added full TDD workflow
  - Added TDD Red-Green-Refactor section with frontend-specific examples
  - Added TDD by Layer table (Model, ViewModel, Components)
  - Added `unit-testing` skill reference
  - Updated build order to be TDD-driven
  - Clarified that frontend-dev writes unit tests (not tester agent)

## [3.5.3] - 2026-01-23

### Added

- **frontend-standards skill**: Extracted MVVM architecture from frontend-dev agent into reusable skill
  - Contains full MVVM layer documentation (Model, ViewModel, View)
  - Includes TanStack ecosystem standards (Router, Query, Table, Form)
  - Provides TailwindCSS styling guidelines
  - Documents state management patterns (Query, Zustand, useState, Router)
  - Includes file naming conventions and summary checklist

### Changed

- **frontend-dev agent**: Simplified to reference skills instead of duplicating content
  - Now references `typescript-standards` and `frontend-standards` skills
  - Retains implementation approach and condensed rules
  - Reduced from ~507 lines to ~56 lines

## [3.5.2] - 2026-01-23

### Added

- **Unix signal handling**: Operator now handles signals for graceful shutdown
  - `SIGTERM` - Kubernetes pod termination (preStop hook, scaling down)
  - `SIGINT` - Ctrl+C from terminal (local development)
  - `SIGHUP` - Terminal hangup
  - Signals trigger graceful shutdown with proper connection draining
  - Logs signal received and shutdown completion

### Changed

- **backend-standards skill**: Added signal handling documentation
  - Signal table with sources and actions
  - Updated summary checklist

## [3.5.1] - 2026-01-23

### Added

- **backend-standards skill**: Extracted CMDO architecture from backend-dev agent into reusable skill
  - Contains full CMDO layer documentation (Operator, Config, Controller, Model, DAL)
  - Includes telemetry standards (logging, metrics, spans)
  - Provides infrastructure vs domain separation guidelines

### Changed

- **backend-dev agent**: Simplified to reference skills instead of duplicating content
  - Now references `typescript-standards` and `backend-standards` skills
  - Retains TDD workflow and build order documentation
  - Reduced from ~400 lines to ~115 lines

## [3.5.0] - 2026-01-23

### Changed

- **Architecture**: Renamed from "5-layer" to CMDO ("Commando" - Controller Model DAL Operator)
  - Renamed `src/app/` directory to `src/operator/`
  - Renamed `create_app.ts` to `create_operator.ts`
  - Renamed types: `App` → `Operator`, `AppState` → `OperatorState`, `AppDependencies` → `OperatorDependencies`
  - Updated `src/index.ts` to use `createOperator` instead of `createApp`
  - Logger component name changed from "app" to "operator"

- **Documentation**: Updated all docs to reflect CMDO architecture
  - `backend-dev.md`: Complete rewrite with CMDO architecture, infrastructure vs domain distinction
  - `README.md`: Updated architecture diagrams and layer descriptions
  - `CLAUDE.md`: Updated backend architecture section
  - `QUICKSTART.md`: Updated core principles

### Rationale

The CMDO naming provides clearer semantics:
- **Operator** = provides raw I/O capabilities (DB, HTTP clients, cache) - NO domain knowledge
- **Config** = provides URLs and settings
- **Controller** = combines I/O + config for domain-specific operations
- **Model** = pure business logic with injected Dependencies

This separation clarifies that Operator handles infrastructure while Controller handles domain concerns.

## [3.4.2] - 2026-01-23

### Changed

- **Telemetry**: Moved into App module
  - Removed `src/telemetry/` directory
  - Added `src/app/logger.ts` and `src/app/metrics.ts`
  - Logger is now created inside `createApp()` as the first operation
  - Simplified `src/index.ts` entry point (only passes config to createApp)
  - App module now owns all telemetry initialization

## [3.4.1] - 2026-01-23

### Fixed

- **Documentation**: Updated architecture diagrams and descriptions
  - Changed "Server layer" to "App layer" in all documentation (CLAUDE.md, README.md, QUICKSTART.md)
  - Added lifecycle probes documentation (port 9090 for Kubernetes health checks)
  - Fixed "5-layer backend" description to show correct flow: App → Controller → Model → Dependencies → DAL

## [3.4.0] - 2026-01-23

### Added

- **Lifecycle probes**: Separate HTTP server for Kubernetes health checks
  - New `lifecycle_probes.ts` module with `/health` and `/readiness` endpoints
  - Runs on dedicated port (default 9090, env var `PROBES_PORT`)
  - `/health` - Always returns 200 when process is alive (for startupProbe/livenessProbe)
  - `/readiness` - Returns 200 only when app state is `RUNNING` (for readinessProbe)
  - Probes server starts first (before database) and stops last (after database)

### Changed

- **State machine**: Added `STARTING:PROBES` and `STOPPING:PROBES` states
  - New startup order: PROBES → DATABASE → HTTP_SERVER
  - New shutdown order: HTTP_SERVER → DATABASE → PROBES
  - Probes available before app is fully ready (for Kubernetes startup checks)

- **HTTP server**: Removed health endpoints from main API server
  - Health checks now handled by dedicated lifecycle probes server
  - Main server focuses solely on API routes

- **Config**: Added `probesPort` configuration
  - Default: 9090
  - Environment variable: `PROBES_PORT`

## [3.3.0] - 2026-01-23

### Changed

- **Test suite**: Rewritten from bash to Python
  - Added `conftest.py` with test framework (ClaudeResult, TestProject classes)
  - Converted all test files to pytest format
  - Added `pytest.ini` and `requirements.txt`
  - Updated `run-all-tests.sh` to use pytest

- **App module refactor**: Consolidated app lifecycle management
  - Moved `create_database.ts` into `app/` module (database is internal to app)
  - Renamed `http_server.ts` to `create_http_server.ts` for consistency
  - Added `state_machine.ts` for generic async state machine implementation

- **State machine with substates**: Improved app lifecycle states
  - States use colon convention for substates: `STARTING:DATABASE`, `STARTING:HTTP_SERVER`, etc.
  - Async transitions with `Promise<void>` return type
  - Auto-transition to first substate when transitioning to parent state
  - Exhaustive switch handling in `onTransition` callback

- **Dependency injection improvements**:
  - App receives `logger: pino.Logger` instead of using console
  - Modules create their own child loggers internally
  - DAL functions use `.bind(null, deps)` for cleaner partial application
  - ID generation moved internal to DAL (not a dependency)

- **Module encapsulation**: Only `createApp` exported from app module

## [3.2.1] - 2026-01-22

### Changed

- **Database module**: Extracted database connection to separate `db/` module
  - `create_database.ts` - Factory function with in-memory implementation
  - App layer now receives database via dependency injection
  - Clear TODO showing how to replace with real database (pg, mysql2, etc.)
  - Proper wiring: index.ts → createDatabase → createApp → DAL functions

## [3.2.0] - 2026-01-22

### Changed

- **Templates simplified**: Replace complex User CRUD with simple Greeting API
  - Contract: `POST /greetings` and `GET /greetings/{id}` endpoints
  - Server: Clean 5-layer architecture (App → Controller → Model → Dependencies → DAL)

- **Webapp MVVM structure**: Proper Model-View-ViewModel architecture
  - Model: `api/greetings.ts` - API client matching OpenAPI contract
  - ViewModel: `hooks/use-greetings.ts` - TanStack Query hooks for state management
  - View: `pages/` and `components/` directories with sidebar navigation
  - Interactive greeter page demonstrating full-stack flow

### Fixed

- **TypeScript module resolution**: Changed from NodeNext to ESNext/Bundler
  - Imports no longer require `.js` extensions
  - Added `tsconfig.node.json` for webapp Vite config
- **Server template type errors**: Fixed null checks in DAL functions
- **Integration test**: Fixed MARKETPLACE_DIR path for plugin discovery

---

## Infrastructure - 2026-01-21

### Added

- **Test framework**: Added plugin test framework for automated testing
  - `tests/test-helpers.sh` with assertion functions
  - `tests/fast/` for quick validation tests
  - `tests/integration/` for full build tests
  - `tests/prompts/` for test input files

### Changed

- **Commit skill**: Refactored from single file to directory structure
  - Moved to `.claude/skills/commit/SKILL.md`

---

## [3.1.0] - 2026-01-21

### Added

- **project-settings skill**: New skill to manage `sdd-settings.yaml` for persisting project configuration
  - Operations: `create`, `read`, `update`
  - Stores plugin version, project metadata, and component selections
  - Git-tracked file in project root

### Changed

- **sdd-init command**: Now uses `project-settings` skill to persist configuration
  - Creates `sdd-settings.yaml` before scaffolding (Step 4.1)
  - Settings available for use by other commands and workflows

## [3.0.1] - 2026-01-21

### Changed

- **Skill directory renames for consistency**
  - `skills/scaffold/` → `skills/scaffolding/`
  - `skills/spec-decomposer/` → `skills/spec-decomposition/`
  - `scaffold.py` → `scaffolding.py`
  - `scaffold.md` → `SKILL.md` (consistent with other skills)

- **Updated all references** in sdd-init.md, QUICKSTART.md, and skill files

## [3.0.0] - 2026-01-21

### Breaking Changes

- **"Change" abstraction replaces "feature"**: All spec-driven workflows now use the "Change" concept
  - Changes can be typed: `feature`, `bugfix`, or `refactor`
  - Directory structure: `specs/features/` → `specs/changes/`
  - Command renamed: `/sdd-new-feature` → `/sdd-new-change --type <type> --name <name>`
  - INDEX.md format: Single list with type indicator instead of separate sections

- **Skill renamed**: `feature-creation` → `change-creation`
  - New required `type` parameter: `feature`, `bugfix`, or `refactor`
  - Type-specific SPEC.md templates with appropriate sections
  - Type-specific PLAN.md templates with streamlined phases for bugfix/refactor

### Added

- **Type-specific SPEC.md templates**
  - `feature`: User stories, acceptance criteria, API contract, domain concepts
  - `bugfix`: Bug description, symptoms, steps to reproduce, root cause, affected areas
  - `refactor`: Refactoring goals, current state, proposed changes, risks

- **Type-specific PLAN.md templates**
  - `feature`: Full 6-phase structure (Domain → Contract → Backend → Frontend → Testing → Review)
  - `bugfix`: Streamlined 4-phase (Investigation → Implementation → Testing → Review)
  - `refactor`: Streamlined 4-phase (Preparation → Implementation → Testing → Review)

- **Change type adjustment in sdd-init decomposition**
  - New option `[T] Change type` to modify decomposed change types

### Changed

- **sdd-new-change command** (formerly sdd-new-feature)
  - Requires `--type` and `--name` arguments
  - Type-specific information prompts (e.g., symptoms for bugfix, goals for refactor)
  - Branch suggestions use type prefix (e.g., `feature/name`, `bugfix/name`, `refactor/name`)

- **sdd-init command**
  - External spec decomposition now outputs "changes" instead of "features"
  - Creates `specs/changes/` directory structure
  - INDEX.md template updated with type column

- **spec-decomposer skill**
  - Output structure: `features` → `changes` in DecompositionResult
  - DecomposedChange includes `type` field (defaults to `feature`)
  - Change IDs: `f1, f2, ...` → `c1, c2, ...`

- **planner agent**
  - Plan location: `specs/changes/YYYY/MM/DD/<change-name>/PLAN.md`
  - Added Change Types table documenting type-specific phase structures

- **planning skill**
  - Added templates for bugfix and refactor plan types
  - Updated plan location to `specs/changes/`

- **scaffold templates**
  - `specs/features/` → `specs/changes/` in directory creation
  - INDEX.md template includes Type column

### Migration Guide

For existing projects using the 2.x structure:
1. Rename `specs/features/` directory to `specs/changes/`
2. Update INDEX.md to include Type column
3. Add `type: feature` to existing SPEC.md and PLAN.md frontmatter
4. Update any scripts or documentation referencing `/sdd-new-feature`
